task 'default' => 'htmlify';

#| Run the Perl 6 htmlify script.
task 'htmlify' => <init-highlights>, {
    run $*EXECUTABLE-NAME, 'htmlify.p6'
}

#| Setup the highlighting code
task 'init-highlights', {
    my $atom-dir = "./highlights/atom-language-perl6".IO;
    my $git-dir = "https://github.com/perl6/atom-language-perl6";
    if $atom-dir.e {
        indir($atom-dir, {
            run(<git pull>);
        });
    } else {
        run('git', 'clone', $git-dir, $atom-dir);
    }
    indir("./highlights", {
        run(<npm install .>);
    });
}

#| Helper sub to run various combinations of test files
sub run-tests(@files) {
    run('prove', '-j', %*ENV<TEST_JOBS> || 1, '-e', $*EXECUTABLE-NAME, |@files);
}

#| Standard tests - every commit should pass these
task 'test',  { run-tests(<t>); }

#| eXtended tests - should very regularly be run to catch issues
task 'xtest', { run-tests(<t xt>); }

#| "Content" tests
task 'ctest', { run-tests(<t/07-tabs.t xt/perl-nbsp.t xt/trailing-whitespace.t>); }
